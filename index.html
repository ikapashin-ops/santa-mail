<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ—á—Ç–∞ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Roboto',sans-serif;background:#135D46;min-height:100vh;overflow-x:hidden;display:flex;align-items:center;justify-content:center;padding:50px 20px}
        body::before,body::after{content:'';position:fixed;left:0;right:0;height:25px;background:repeating-linear-gradient(45deg,#499F87 0,#499F87 40px,transparent 40px,transparent 56px,#FF5252 56px,#FF5252 96px,transparent 96px,transparent 112px);z-index:9999;pointer-events:none}
        body::before{top:0}
        body::after{bottom:0}
        .snow{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:2;overflow:hidden}
        .flake{position:absolute;top:-50px;opacity:0;animation:fall linear infinite}
        @keyframes fall{0%{transform:translateY(-50px);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(calc(100vh + 50px));opacity:0}}
        .wrap{max-width:700px;width:100%;position:relative;z-index:10}
        .santa{position:absolute;top:-30px;right:-30px;font-size:80px;transform:scaleX(-1);animation:wave 3s ease-in-out infinite;z-index:5}
        @keyframes wave{0%,100%{transform:scaleX(-1) translateY(0)}50%{transform:scaleX(-1) translateY(-8px)}}
        .deadline{background:#499F87;color:#fff;padding:15px 30px;border-radius:12px;text-align:center;font-weight:bold;font-size:18px;margin-bottom:30px;box-shadow:0 0 20px rgba(73,159,135,0.3)}
        .form{background:#fef9f0;border:5px solid #FF5252;border-radius:30px;padding:40px;box-shadow:0 0 40px rgba(73,159,135,0.4),0 0 80px rgba(73,159,135,0.2)}
        h1{color:#FF5252;font-size:36px;font-weight:bold;text-align:center;margin-bottom:15px;margin-top:0}
        .sub{color:#135D46;font-size:16px;text-align:center;margin-bottom:30px}
        .group{margin-bottom:25px}
        label{display:block;margin-bottom:8px;font-size:16px;font-weight:bold;color:#135D46}
        input,textarea{width:100%;padding:15px;border:3px solid #499F87;border-radius:12px;font-size:16px;font-family:'Roboto',sans-serif}
        input:focus,textarea:focus{outline:none;border-color:#FF5252}
        textarea{min-height:180px;resize:vertical}
        button{background:#FF5252;color:#fff;padding:18px 40px;border:none;border-radius:16px;font-size:20px;font-weight:bold;cursor:pointer;width:100%;transition:all 0.3s}
        button:hover{background:#e63946;transform:translateY(-3px)}
        button:disabled{opacity:0.6;cursor:not-allowed}
        .msg{background:#499F87;color:#fff;padding:20px 30px;border-radius:12px;margin-top:25px;text-align:center;font-size:16px;font-weight:normal;display:none;border-left:5px solid #135D46;box-shadow:0 4px 15px rgba(73,159,135,0.3)}
        @media(max-width:768px){body::before,body::after{height:40px}.wrap{margin:60px auto}.form{padding:30px 20px}h1{font-size:28px}}
    </style>
</head>
<body>
    <div class="snow" id="snow"></div>
    <audio id="music" loop>
        <source src="https://ikapashin-ops.github.io/santa-mail/compressed.mp3" type="audio/mpeg">
    </audio>
    <div class="wrap">
        <div class="deadline">‚è∞ –ü—Ä–∏—ë–º –ø–∏—Å–µ–º –¥–æ 24 –¥–µ–∫–∞–±—Ä—è –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ</div>
        <div class="form">
            <div class="santa">üéÖ</div>
            <h1>‚úâÔ∏è –ü–æ—á—Ç–∞ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞</h1>
            <p class="sub">–ù–∞–ø–∏—à–∏—Ç–µ —Ç—ë–ø–ª—ã–µ —Å–ª–æ–≤–∞ –∫–æ–ª–ª–µ–≥–∞–º –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ!</p>
            <form id="f">
                <div class="group">
                    <label for="n">–í–∞—à–µ –∏–º—è <span style="color:#FF5252">*</span></label>
                    <input type="text" id="n" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" required>
                </div>
                <div class="group">
                    <label for="r">–ö–æ–º—É –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–æ</label>
                    <input type="text" id="r" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—Ä–∏–∏ –ò–≤–∞–Ω–æ–≤–æ–π –∏–∑ –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂">
                </div>
                <div class="group">
                    <label for="m">–í–∞—à–µ –ø–∏—Å—å–º–æ <span style="color:#FF5252">*</span></label>
                    <textarea id="m" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å, –ø–æ–∂–µ–ª–∞–Ω–∏–µ –∏–ª–∏ —Ç—ë–ø–ª—ã–µ —Å–ª–æ–≤–∞..." required></textarea>
                </div>
                <button type="submit" id="submitBtn">ü¶å –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ</button>
            </form>
            <div class="msg" id="msg">‚ú® –ü–∏—Å—å–º–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ! üéÑ</div>
        </div>
    </div>

    <script>
        const token = '8587638548:AAF11Jq3P-bWbZHI_2FonXGn08SpTZGPTuQ';
        const chat_id = '742126021';

        document.getElementById('f').onsubmit = async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º...';
            
            const name = document.getElementById('n').value;
            const recipient = document.getElementById('r').value;
            const message = document.getElementById('m').value;
            
            try {
                const text = `üéÑ –ù–æ–≤–æ–µ –ø–∏—Å—å–º–æ –î–µ–¥—É –ú–æ—Ä–æ–∑—É!\n\nüë§ –û—Ç: ${name}\nüì® –ö–æ–º—É: ${recipient || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n\nüíå –ü–∏—Å—å–º–æ:\n${message}`;
                
                await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({chat_id, text})
                });
                
                submitBtn.textContent = 'üìÑ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF...';
                const pdfBlob = await generateCanvasPDF(name, message);
                
                submitBtn.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º PDF...';
                await sendToTelegram(pdfBlob, name);
                
                document.getElementById('msg').style.display = 'block';
                e.target.reset();
                submitBtn.textContent = '‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
                
                setTimeout(() => {
                    document.getElementById('msg').style.display = 'none';
                    submitBtn.textContent = 'ü¶å –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ';
                    submitBtn.disabled = false;
                }, 5000);
                
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞:', err);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + err.message);
                submitBtn.textContent = 'ü¶å –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ';
                submitBtn.disabled = false;
            }
        };

        async function generateCanvasPDF(sender, message) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                canvas.width = 1600;
                canvas.height = 2200;
                const ctx = canvas.getContext('2d');
                
                // –ó–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω
                ctx.fillStyle = '#135D46';
                ctx.fillRect(0, 0, 1600, 2200);
                
                function drawSkewedRect(x, y, width, height, skew, color) {
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(x + skew, y);
                    ctx.lineTo(x + width + skew, y);
                    ctx.lineTo(x + width, y + height);
                    ctx.lineTo(x, y + height);
                    ctx.closePath();
                    ctx.fill();
                }
                
                // –í–µ—Ä—Ö–Ω–∏–µ –ø–æ–ª–æ—Å–∫–∏ (50px –≤—ã—Å–æ—Ç–∞ –∫–∞–∫ –Ω–∞ —Å–∞–π—Ç–µ)
                const stripWidth = 140;
                const stripGap = 32;
                const stripHeight = 50;
                const skewAmount = 30;
                
                let xPos = -50;
                let colors = ['#499F87', '#FF5252'];
                let colorIndex = 0;
                
                while (xPos < 1650) {
                    drawSkewedRect(xPos, 0, stripWidth, stripHeight, skewAmount, colors[colorIndex % 2]);
                    xPos += stripWidth + stripGap + skewAmount;
                    colorIndex++;
                }
                
                xPos = -50;
                colorIndex = 0;
                while (xPos < 1650) {
                    drawSkewedRect(xPos, 2150, stripWidth, stripHeight, skewAmount, colors[colorIndex % 2]);
                    xPos += stripWidth + stripGap + skewAmount;
                    colorIndex++;
                }
                
                // –°–Ω–µ–∂–∏–Ω–∫–∏ (—Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—ã–µ, –Ω–µ –ø–∞—Ç—Ç–µ—Ä–Ω)
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.12)';
                ctx.lineWidth = 3;
                
                // –§—É–Ω–∫—Ü–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –∑–≤–µ–∑–¥–æ—á–∫–∏ (8 –ª—É—á–µ–π)
                function drawStar(cx, cy, size) {
                    ctx.beginPath();
                    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
                    ctx.moveTo(cx, cy - size);
                    ctx.lineTo(cx, cy + size);
                    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
                    ctx.moveTo(cx - size, cy);
                    ctx.lineTo(cx + size, cy);
                    // –î–∏–∞–≥–æ–Ω–∞–ª—å 1
                    ctx.moveTo(cx - size * 0.7, cy - size * 0.7);
                    ctx.lineTo(cx + size * 0.7, cy + size * 0.7);
                    // –î–∏–∞–≥–æ–Ω–∞–ª—å 2
                    ctx.moveTo(cx + size * 0.7, cy - size * 0.7);
                    ctx.lineTo(cx - size * 0.7, cy + size * 0.7);
                    ctx.stroke();
                }
                
                // –°–ª—É—á–∞–π–Ω–æ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—ã–µ —Å–Ω–µ–∂–∏–Ω–∫–∏
                const snowflakes = [
                    {x: 150, y: 200, size: 20}, {x: 340, y: 280, size: 25}, {x: 520, y: 180, size: 18},
                    {x: 680, y: 320, size: 22}, {x: 850, y: 220, size: 20}, {x: 1020, y: 340, size: 24},
                    {x: 1180, y: 260, size: 19}, {x: 1350, y: 190, size: 23}, {x: 1450, y: 310, size: 21},
                    
                    {x: 200, y: 580, size: 18}, {x: 380, y: 680, size: 22}, {x: 580, y: 620, size: 20},
                    {x: 760, y: 720, size: 24}, {x: 920, y: 650, size: 19}, {x: 1100, y: 760, size: 21},
                    {x: 1280, y: 690, size: 23}, {x: 1420, y: 780, size: 20},
                    
                    {x: 180, y: 1080, size: 22}, {x: 360, y: 1180, size: 20}, {x: 540, y: 1120, size: 24},
                    {x: 720, y: 1220, size: 19}, {x: 900, y: 1160, size: 21}, {x: 1080, y: 1260, size: 23},
                    {x: 1260, y: 1200, size: 20}, {x: 1440, y: 1140, size: 22},
                    
                    {x: 220, y: 1580, size: 21}, {x: 400, y: 1680, size: 23}, {x: 600, y: 1620, size: 19},
                    {x: 780, y: 1720, size: 22}, {x: 960, y: 1660, size: 20}, {x: 1140, y: 1760, size: 24},
                    {x: 1320, y: 1700, size: 21}, {x: 1460, y: 1640, size: 20},
                    
                    {x: 260, y: 2020, size: 23}, {x: 460, y: 2060, size: 20}, {x: 660, y: 1980, size: 22},
                    {x: 860, y: 2040, size: 19}, {x: 1060, y: 2000, size: 21}, {x: 1240, y: 2080, size: 24}
                ];
                
                snowflakes.forEach(sf => {
                    drawStar(sf.x, sf.y, sf.size);
                });
                
                // –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∑–µ–ª—ë–Ω—ã–º —Å–≤–µ—á–µ–Ω–∏–µ–º
                ctx.shadowColor = 'rgba(73, 159, 135, 0.4)';
                ctx.shadowBlur = 40;
                ctx.fillStyle = '#FEF9F0';
                roundRect(ctx, 200, 400, 1200, 1400, 60);
                ctx.fill();
                ctx.shadowBlur = 0;
                
                // –ö—Ä–∞—Å–Ω–∞—è –æ–±–≤–æ–¥–∫–∞
                ctx.strokeStyle = '#FF5252';
                ctx.lineWidth = 10;
                roundRect(ctx, 200, 400, 1200, 1400, 60);
                ctx.stroke();
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫
                ctx.fillStyle = '#FF5252';
                ctx.font = 'bold 90px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üîî –ü–æ—á—Ç–∞ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞', 800, 580);
                
                ctx.fillStyle = '#135D46';
                ctx.font = '44px Arial';
                ctx.fillText('–ù–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç –∫–æ–ª–ª–µ–≥–∏!', 800, 660);
                
                // –õ–∏–Ω–∏—è
                ctx.strokeStyle = '#499F87';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(300, 720);
                ctx.lineTo(1300, 720);
                ctx.stroke();
                
                // –û—Ç –∫–æ–≥–æ
                ctx.fillStyle = '#135D46';
                ctx.font = 'bold 40px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('–û—Ç –∫–æ–≥–æ:', 300, 810);
                ctx.font = '40px Arial';
                ctx.fillText(sender, 300, 870);
                
                ctx.strokeStyle = '#499F87';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(300, 920);
                ctx.lineTo(1300, 920);
                ctx.stroke();
                
                // –ü–∏—Å—å–º–æ
                ctx.font = 'bold 40px Arial';
                ctx.fillText('–ü–∏—Å—å–º–æ:', 300, 1010);
                
                ctx.fillStyle = '#135D46';
                ctx.font = '36px Arial';
                
                const words = message.split(' ');
                let line = '';
                let y = 1100;
                const maxWidth = 1000;
                const lineHeight = 56;
                
                for (let i = 0; i < words.length; i++) {
                    const testLine = line + words[i] + ' ';
                    const metrics = ctx.measureText(testLine);
                    
                    if (metrics.width > maxWidth && i > 0) {
                        ctx.fillText(line, 300, y);
                        line = words[i] + ' ';
                        y += lineHeight;
                        if (y > 1650) break;
                    } else {
                        line = testLine;
                    }
                }
                ctx.fillText(line, 300, y);
                
                // –î–∞—Ç–∞
                const date = new Date().toLocaleDateString('ru-RU', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric' 
                });
                ctx.fillStyle = '#135D46';
                ctx.font = '32px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(date, 1300, 1750);
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
                
                resolve(pdf.output('blob'));
            });
        }

        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        async function sendToTelegram(pdfBlob, sender) {
            const formData = new FormData();
            formData.append('chat_id', chat_id);
            formData.append('document', pdfBlob, `novogodnee_pismo_${sender.replace(/\s+/g, '_')}.pdf`);
            
            const response = await fetch(`https://api.telegram.org/bot${token}/sendDocument`, {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) throw new Error('Telegram API error');
            return response.json();
        }
        
        const music = document.getElementById('music');
        let started = false;
        document.body.addEventListener('click', () => {
            if (!started) {
                music.play();
                started = true;
            }
        }, { once: true });
        
        const c = document.getElementById('snow');
        const s = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><g fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><line x1="25" y1="5" x2="25" y2="45"/><line x1="5" y1="25" x2="45" y2="25"/><line x1="12" y1="12" x2="38" y2="38"/><line x1="38" y1="12" x2="12" y2="38"/></g></svg>';
        
        function f() {
            const d = document.createElement('div');
            d.className = 'flake';
            const z = Math.random() * 12 + 4;
            const l = Math.random() * 100;
            const t = Math.random() * 8 + 12;
            d.innerHTML = s;
            d.style.cssText = `width:${z}px;height:${z}px;left:${l}%;opacity:${Math.random()*0.5+0.3};animation-duration:${t}s`;
            c.appendChild(d);
            setTimeout(() => d.remove(), t * 1000);
        }
        
        for (let i = 0; i < 180; i++) setTimeout(f, i * 40);
        setInterval(f, 80);
    </script>
</body>
</html>
